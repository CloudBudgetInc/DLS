<template>
	<lightning-card title="Current Vs. Prior Vs. Budget Month P&L Summary">

		<lightning-layout slot="actions">
			<lightning-layout-item>
				<div class="slds-p-top_large">
					<lightning-button label="Download" icon-name="doctype:excel" onclick={downloadToExcel}>
					</lightning-button>
				</div>
			</lightning-layout-item>
			<lightning-layout-item>
				<div class="slds-p-top_large">
					<lightning-button label="Refresh" icon-name="utility:refresh" onclick={renderReport}>
					</lightning-button>
				</div>
			</lightning-layout-item>
			<lightning-layout-item>
				<lightning-combobox
						name="selectedReportType"
						label="Report Type"
						value={selectedReportType}
						options={reportTypeSO}
						onchange={handleChangeMainFilter}></lightning-combobox>
			</lightning-layout-item>
			<lightning-layout-item>
				<lightning-combobox
						name="selectedPeriodId"
						label="Period"
						value={selectedPeriodId}
						placeholder="Select Some Period"
						options={periodSO}
						onchange={handleChangeMainFilter}></lightning-combobox>
			</lightning-layout-item>
		</lightning-layout>

		<template lwc:if={readyToRender}>
			<div style="overflow-x:auto; height: 70vh">
				<table class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_striped slds-table_sticky-header">
					<thead>
					<tr class="slds-line-height_reset">
						<th>
							<div class="slds-truncate" title="Label">Label</div>
						</th>
						<th>
							<div class="slds-truncate dec" title="Current Month Actual">Current Month</div>
						</th>
						<th>
							<div class="slds-truncate dec" title="Current Month Budget">Current Budget</div>
						</th>
						<th>
							<div class="slds-truncate dec" title="Current Month Dollar Diff">Dollar Diff</div>
						</th>
						<th>
							<div class="slds-truncate dec" title="Current Month Percent Diff">Percent Diff</div>
						</th>
						<th>
							<div class="slds-truncate dec" title="Prior Month Actual">Prior Month</div>
						</th>
						<th>
							<div class="slds-truncate dec" title="Prior Month Dollar Diff">Dollar Diff</div>
						</th>
						<th>
							<div class="slds-truncate dec" title="Prior Month Percent Diff">Percent Diff</div>
						</th>
						<th>
							<div class="slds-truncate dec" title="Prior Year Actual">Prior Year</div>
						</th>
						<th>
							<div class="slds-truncate dec" title="Prior Year Dollar Diff">Dollar Diff</div>
						</th>
						<th>
							<div class="slds-truncate dec" title="Prior Year Percent Diff">Percent Diff</div>
						</th>
					</tr>
					</thead>
					<tbody>
					<template for:each={reportLines} for:item="rl">
						<tr class={rl.styleClass} key={rl}>
							<th class={rl.styleClass}>
								{rl.label}
							</th>

							<!-- CURRENT MONTH -->
							<th class={rl.styleClass}>
								<lightning-formatted-number value={rl.currentMonthActual} format-style={rl.formatStyle}
															class="dec"
															currency-code="USD"></lightning-formatted-number>
							</th>
							<th class={rl.styleClass}>
								<lightning-formatted-number value={rl.currentMonthBudget} format-style={rl.formatStyle}
															class="dec"
															currency-code="USD"></lightning-formatted-number>
							</th>
							<th class={rl.styleClass}>
								<lightning-formatted-number value={rl.currentMonthDiff} format-style={rl.formatStyle}
															class="dec"
															currency-code="USD"></lightning-formatted-number>
							</th>
							<th class={rl.styleClass}>
								<lightning-formatted-number value={rl.currentMonthDiffPercent} class="dec"
															format-style="percent"></lightning-formatted-number>
							</th>
							<!-- CURRENT MONTH -->

							<!-- PRIOR MONTH -->
							<th class={rl.styleClass}>
								<lightning-formatted-number value={rl.priorMonthActual} format-style={rl.formatStyle}
															class="dec"
															currency-code="USD"></lightning-formatted-number>
							</th>
							<th class={rl.styleClass}>
								<lightning-formatted-number value={rl.priorMonthDiff} format-style={rl.formatStyle}
															class="dec"
															currency-code="USD"></lightning-formatted-number>
							</th>
							<th class={rl.styleClass}>
								<lightning-formatted-number value={rl.priorMonthDiffPercent} class="dec"
															format-style="percent"></lightning-formatted-number>
							</th>
							<!-- PRIOR MONTH -->

							<!-- PRIOR YEAR -->
							<th class={rl.styleClass}>
								<lightning-formatted-number value={rl.priorYearActual} format-style={rl.formatStyle}
															class="dec"
															currency-code="USD"></lightning-formatted-number>
							</th>
							<th class={rl.styleClass}>
								<lightning-formatted-number value={rl.priorYearDiff} format-style={rl.formatStyle}
															class="dec"
															currency-code="USD"></lightning-formatted-number>
							</th>
							<th class={rl.styleClass}>
								<lightning-formatted-number value={rl.priorYearDiffPercent} class="dec"
															format-style="percent"></lightning-formatted-number>
							</th>
							<!-- PRIOR YEAR -->

						</tr>
					</template>
					</tbody>
				</table>
			</div>
		</template>

		<c-cb-spinner show={showSpinner}></c-cb-spinner>
	</lightning-card>
</template>
